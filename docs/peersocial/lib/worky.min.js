(function(root){if(typeof window==="object"&&!window.Worker){return alert("This browser does not support web workers.")}function EventEmitter(){this._={}}EventEmitter.prototype._on=function(ev,fn){var l=this._[ev]=this._[ev]||[];l.push(fn);return this};EventEmitter.prototype._emit=function(ev){var self=this,args=[],event=null,l=null;if(typeof ev==="object"){event=ev.event;args=ev.args}else{event=ev;args=Array.prototype.slice.call(arguments,1)}l=this._[event];if(!l||!l.length){return}l.forEach(function(fn){fn.apply(self,args)});return this};EventEmitter.prototype.on=EventEmitter.prototype._on;EventEmitter.prototype.emit=EventEmitter.prototype._emit;function Worky(script){var self={};if(this.constructor!==Worky&&script){return new Worky(script)}if(!script){self=Object.create(EventEmitter.prototype)}else{self=this}EventEmitter.call(self);self.is_worker=!script;if(self.is_worker){root.onmessage=Worky.Receiver.call(self);self.emit=Worky.Emitter.call(root);return self}if(typeof script==="string"){self.worker=new Worker(script)}else{self.worker=script}self.worker.onmessage=Worky.Receiver.call(self);self.emit=Worky.Emitter.call(self.worker)}Worky.EventEmitter=EventEmitter;Worky.Receiver=function(){var self=this;return function(ev){self._emit(ev.data)}};Worky.Emitter=function(){var self=this;return function(){var ev=new Worky.Message(arguments);self.postMessage(ev)}};Worky.Message=function(args){args=Array.prototype.slice.call(args);this.event=args[0];this.args=args.slice(1)};Worky.prototype=Object.create(EventEmitter.prototype);Worky.prototype.constructor=Worky;root.Worky=Worky})(self);